<Page
    x:Class="KinopoiskUWP.Views.MainPage"
    x:Name="pageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:KinopoiskUWP.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="#1f1f1f">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>

        <Style x:Key="HiddenScrollViewerStyle" TargetType="ScrollViewer">
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
        </Style>

        <Style TargetType="ComboBox" x:Key="FilterComboBoxStyle">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="BorderBrush" Value="#666666"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5,2"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="MinWidth" Value="200"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <DataTemplate x:Key="FilmTemplate">
            <Grid Width="360" Height="600" Margin="10">
                <Border Background="#2a2a2a" CornerRadius="8" Padding="5">
                    <StackPanel>
                        <Grid Width="350" Height="520">
                            <Image Source="{Binding PosterUrlPreview}" 
                                 Stretch="UniformToFill" 
                                 Width="350" 
                                 Height="520">
                                <Image.DataContext>
                                    <Binding Path="PosterUrlPreview">
                                        <Binding.TargetNullValue>
                                            <BitmapImage UriSource="ms-appx:///Assets/Placeholder.png"/>
                                        </Binding.TargetNullValue>
                                    </Binding>
                                </Image.DataContext>
                            </Image>

                            <Button Command="{Binding DataContext.AddToFavoritesCommand, 
                                                   ElementName=pageRoot}"
                                    CommandParameter="{Binding}"
                                    Background="#66000000" 
                                    BorderBrush="Transparent"
                                    FontSize="20" 
                                    Foreground="Yellow"
                                    HorizontalAlignment="Left" 
                                    VerticalAlignment="Top" 
                                    Margin="5" 
                                    Width="40" 
                                    Height="40"
                                    Content="★">
                                <Button.Visibility>
                                    <Binding Path="IsFavorite" 
                                           Converter="{StaticResource BoolToVisibilityConverter}"
                                           ConverterParameter="invert"/>
                                </Button.Visibility>
                            </Button>
                        </Grid>

                        <TextBlock Text="{Binding NameRu}" 
                                 FontWeight="Bold" 
                                 Foreground="White" 
                                 TextAlignment="Center" 
                                 TextWrapping="Wrap" 
                                 Margin="0,5,0,0"/>

                        <TextBlock Text="{Binding Year}" 
                                 FontStyle="Italic" 
                                 Foreground="Gray" 
                                 TextAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </DataTemplate>
    </Page.Resources>

    <Grid>
        <ScrollViewer Style="{StaticResource HiddenScrollViewerStyle}">
            <StackPanel Margin="20">
                <TextBlock Text="Популярные фильмы" 
                         FontSize="24" 
                         FontWeight="Bold" 
                         Foreground="White" 
                         Margin="0,0,0,10"/>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                    <ComboBox Style="{StaticResource FilterComboBoxStyle}"
                            ItemsSource="{Binding Genres}"
                            DisplayMemberPath="Name"
                            SelectedItem="{Binding SelectedGenre, Mode=TwoWay}"/>

                    <ComboBox Style="{StaticResource FilterComboBoxStyle}"
                            ItemsSource="{Binding Countries}"
                            DisplayMemberPath="Name"
                            SelectedItem="{Binding SelectedCountry, Mode=TwoWay}"
                            Margin="10,0,0,0"/>
                </StackPanel>

                <GridView ItemsSource="{Binding Films}"
                          ItemTemplate="{StaticResource FilmTemplate}"
                          SelectionMode="None"
                          IsItemClickEnabled="True"
                          ItemClick="FilmItem_Click">
                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </GridView>
            </StackPanel>
        </ScrollViewer>

        <ProgressRing IsActive="{Binding IsLoading}" 
                     HorizontalAlignment="Center" 
                     VerticalAlignment="Center"
                     Width="50" 
                     Height="50"
                     Foreground="#3B7DD8"/>

        <TextBlock Text="{Binding ErrorMessage}"
                  Foreground="Red"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Bottom"
                  Margin="20"
                  TextWrapping="Wrap"
                  Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
    </Grid>
</Page>