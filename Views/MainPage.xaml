<Page
    x:Class="KinopoiskUWP.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:KinopoiskUWP.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <!-- Стиль для скрытия ScrollBar -->
        <Style x:Key="HiddenScrollViewerStyle" TargetType="ScrollViewer">
            <Setter Property="VerticalScrollBarVisibility" Value="Hidden"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
        </Style>

        <!-- Стиль для ComboBox -->
        <Style TargetType="ComboBox" x:Key="FilterComboBoxStyle">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="BorderBrush" Value="#666666"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5,2"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="MinWidth" Value="200"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- Конвертер для видимости -->
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Page.Resources>

    <Grid Background="#1f1f1f">
        <ScrollViewer Style="{StaticResource HiddenScrollViewerStyle}">
            <StackPanel Margin="20">
                <TextBlock Text="Популярные фильмы" 
                         FontSize="24" 
                         FontWeight="Bold" 
                         Foreground="White" 
                         Margin="0,0,0,10"/>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                    <ComboBox Style="{StaticResource FilterComboBoxStyle}"
                            ItemsSource="{Binding Genres}"
                            DisplayMemberPath="Name"
                            SelectedItem="{Binding SelectedGenre, Mode=TwoWay}"/>

                    <ComboBox Style="{StaticResource FilterComboBoxStyle}"
                            ItemsSource="{Binding Countries}"
                            DisplayMemberPath="Name"
                            SelectedItem="{Binding SelectedCountry, Mode=TwoWay}"
                            Margin="10,0,0,0"/>
                </StackPanel>

                <ItemsControl ItemsSource="{Binding Films}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Width="360" Height="600" Margin="10">
                                <Border Background="#2a2a2a" CornerRadius="8" Padding="5">
                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup>
                                            <VisualState x:Name="Normal"/>
                                            <VisualState x:Name="PointerOver">
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="scaleTransform" 
                                                                   Storyboard.TargetProperty="ScaleX"
                                                                   To="1.05" Duration="0:0:0.2"/>
                                                    <DoubleAnimation Storyboard.TargetName="scaleTransform" 
                                                                   Storyboard.TargetProperty="ScaleY"
                                                                   To="1.05" Duration="0:0:0.2"/>
                                                </Storyboard>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>

                                    <Border.RenderTransform>
                                        <ScaleTransform x:Name="scaleTransform" ScaleX="1" ScaleY="1"/>
                                    </Border.RenderTransform>

                                    <StackPanel>
                                        <Grid Width="350" Height="520">
                                            <Button Command="{Binding DataContext.NavigateToFilmDetailsCommand, 
                                                                    ElementName=pageRoot}"
                                                    CommandParameter="{Binding}"
                                                    Background="Transparent" 
                                                    BorderBrush="Transparent">
                                                <Image Source="{Binding PosterUrlPreview}" 
                                                     Stretch="UniformToFill" 
                                                     Width="350" Height="520"/>
                                            </Button>

                                            <Button Content="★"
                                                    Command="{Binding DataContext.AddToFavoritesCommand, 
                                                                   ElementName=pageRoot}"
                                                    CommandParameter="{Binding}"
                                                    Background="#66000000" 
                                                    BorderBrush="Transparent"
                                                    FontSize="20" 
                                                    Foreground="Yellow"
                                                    HorizontalAlignment="Left" 
                                                    VerticalAlignment="Top" 
                                                    Margin="5" 
                                                    Width="40" 
                                                    Height="40">
                                                <Button.Visibility>
                                                    <Binding Path="IsFavorite" 
                                                           Converter="{StaticResource BoolToVisibilityConverter}"
                                                           ConverterParameter="invert"/>
                                                </Button.Visibility>
                                            </Button>
                                        </Grid>

                                        <TextBlock Text="{Binding NameRu}" 
                                                 FontWeight="Bold" 
                                                 Foreground="White" 
                                                 TextAlignment="Center" 
                                                 TextWrapping="Wrap" 
                                                 Margin="0,5,0,0"/>

                                        <TextBlock Text="{Binding Year}" 
                                                 FontStyle="Italic" 
                                                 Foreground="Gray" 
                                                 TextAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>